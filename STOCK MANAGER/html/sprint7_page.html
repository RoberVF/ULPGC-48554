<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>STOCK MANAGER: SPRINT 7. MIGRACION DEL PROYECTO A ARDUINO, ESP, WEB</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">STOCK MANAGER
   </div>
   <div id="projectbrief">Aplicaci√≥n local para gestionar el inventario de la despensa</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('sprint7_page.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">SPRINT 7. MIGRACION DEL PROYECTO A ARDUINO, ESP, WEB </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_docs_2_s_p_r_i_n_t__7"></a></p>
<p>Teniendo en cuenta la idea principal de desarrollar la aplicacion real, vamos a desglosar como seria el procedimiento:</p><ul>
<li>El ESP como "servidor" y como "Access Point" ya que nuestro telefono se conectara a el.</li>
<li>El telefono movil se conectara a la red WiFi del ESP.</li>
<li>En cuanto a la Web <a class="el" href="namespace_app.html">App</a>, una vez que el telefono este conectado a la red WiFi del ESP, se abrira el navegador del telefono y se accedera a la direccion IP del ESP. Ahi encontraremos la vista, desarrollada solamente en HTML, CSS y JS.</li>
<li>Se debera de reescribir todo el proyecto a C++, ya que el ESP no tiene capacidad de interpretacion de PHP y, por tanto, habra que utilizar la misma logica que tenemos de la aplicacion PHP a C++, montar el enrutamiento, modelo, controlador, todo en C++.</li>
<li>Una vez esto es hecho, cuando se realice un cambio en la Web <a class="el" href="namespace_app.html">App</a> desde el dispositivo movil, se hara un fetch a una ruta de las desarrolladas en C++, consiguiendo asi la modificacion que queramos. Basicamente hacer una API REST en C++ que este en el ESP.</li>
<li>Ademas, el ESP tiene su pantalla TFT la cual muestra otra informacion, en este caso, la lista de productos y el aumento/decremento de stock.</li>
<li>Lo mas importante es que tanto la Web <a class="el" href="namespace_app.html">App</a> como la pantalla TFT del ESP deben trabajar sobre la misma base de datos y el ESP no tiene una forma nativa de utilizar SQLite. Para ello trabajaremos sobre un archivo .json que guardaremos en la memoria SPIFFS del ESP. Ambos (la Web <a class="el" href="namespace_app.html">App</a> y el ESP) escribiran sobre dicho archivo, manteniendo asi el modelo unificado.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md20"></a>
El ESP</h2>
<p>Se debera de programar en C++/Arduino y se deberan de hacer las siguientes cosas:</p><ul>
<li>El Access Point WiFi (Utilizando la libreria proporcionada por el profesor, ya que es mejor que la basica WiFi.h)</li>
<li>El servidor web (Utilizando a priori la libreria WebServer.h)</li>
<li>El controlador de la pantalla TFT (He encontrado la libreria TFT_eSPI.h, ahora habra que ver que sea valida)</li>
<li>El "Modelo" / Gestor de datos, entendiendo como esta la API o el "backend" en C++, convirtiendo el <a class="el" href="_product_controller_8php.html">ProductController.php</a> en una API REST. Aqui se definiran rutas tipo /api/products [GET], /api/add [POST], /api/stock/increase [POST], etc.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md21"></a>
La Web App</h1>
<p>Ahora no tendremos una aplicacion "fullstack" sino un SPA (Single Page Application) que sera solamente frontend. Como el ESP guardara y manejara las funcionalidades, cuando el usuario con su telefono este conectado al WiFi del ESP y acceda a la direccion IP de este, se enviaran los tres archivos (HTML, CSS y JS). A partir de ahi, sera el JS el encargado de fetchear las rutas, es decir, si necesito por ejemplo, agregar algun producto manualmente, hara un fetch a /api/add para meterlo o cuando se necesite la lista de productos, estos se conseguiran haciendo una peticion a la API del ESP.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md22"></a>
La Base de Datos</h2>
<p>Como comentaba al principio, no se podra utilizar SQLite de forma nativa y sencilla en el ESP. La solucion que he encontrado ha sido utilizar la persistencia que ofrece el ESP con su sistema de archivos internos SPIFFS o LittleFS (Como aun no he hecho la aplicacion no se mucho acerca de esto). Suponiendo que esto del SPIFFS funcione, en lugar de una base de datos SQL, la "base de datos" sera directamente un archivo .json, por ejemplo, database.json que guardare en la memoria SPIFFS del ESP. Tanto la Web <a class="el" href="namespace_app.html">App</a> como la "aplicacion" de la pantalla TFT escribiran sobre el mismo archivo database.json, consiguiendo mantener asi el modelo unificado.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md23"></a>
La pantalla TFT</h2>
<p>Cuando el ESP arranque, leera el archivo database.json y mostrara los productos en la TFT. Si se pulsa un boton fisico en la pantalla, por ejemplo "STOCK +", se incrementara el stock del producto y se refrescara la pantalla. Si alguien incluye algun producto desde la Web <a class="el" href="namespace_app.html">App</a> del telefono, programaremos el ESP para que se refresque la TFT. Aunque de momento, incluiremos un boton de refrescar en la pantalla para actualizar la informacion de la base de datos. Dado que no podemos integrar un HTML + CSS en el ESP, debo crear la interfaz grafica a mano. Para ello, utilizare la libreria TFT_eSPI.h, la cual no he utilizado nunca pero por lo que he estado leyendo es la mas comun cuando se trata de hacer interfaces graficas en TFT y la mas potente. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
